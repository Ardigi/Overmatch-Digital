_format_version: "3.0"
_transform: true

services:
  # Auth Service - Port 3001
  - name: auth-service
    url: http://auth-service:3001
    retries: 3
    connect_timeout: 10000
    write_timeout: 10000
    read_timeout: 10000
    routes:
      - name: auth-public-routes
        paths:
          - /api/v1/auth/login
          - /api/v1/auth/register
          - /api/v1/auth/refresh
          - /api/v1/auth/health
        strip_path: false
        preserve_host: true
        methods: ["GET", "POST", "OPTIONS"]
        protocols: ["http", "https"]

  # Client Service - Port 3002
  - name: client-service
    url: http://client-service:3002
    retries: 3
    connect_timeout: 10000
    write_timeout: 10000
    read_timeout: 10000
    routes:
      - name: client-routes
        paths:
          - /api/v1/clients
        strip_path: false
        preserve_host: true
        methods: ["GET", "POST", "PUT", "PATCH", "DELETE", "OPTIONS"]
        protocols: ["http", "https"]
    plugins:
      - name: jwt
        config:
          secret_is_base64: false
          claims_to_verify: ["exp"]
      - name: request-transformer
        config:
          add:
            headers:
              x-user-id: "$(consumer.id)"
              x-user-email: "$(consumer.username)"
              x-organization-id: "$(consumer.custom_id)"

  # Control Service - Port 3004
  - name: control-service
    url: http://control-service:3004
    retries: 3
    connect_timeout: 10000
    write_timeout: 10000
    read_timeout: 10000
    routes:
      - name: control-routes
        paths:
          - /api/v1/controls
        strip_path: false
        preserve_host: true
        methods: ["GET", "POST", "PUT", "PATCH", "DELETE", "OPTIONS"]
        protocols: ["http", "https"]
    plugins:
      - name: jwt
        config:
          secret_is_base64: false
          claims_to_verify: ["exp"]
      - name: request-transformer
        config:
          add:
            headers:
              x-user-id: "$(consumer.id)"
              x-user-email: "$(consumer.username)"
              x-organization-id: "$(consumer.custom_id)"