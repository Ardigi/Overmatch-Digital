# Client Service E2E Tests

This directory contains end-to-end tests for the client service.

## Setup

1. Create test database:
   ```bash
   createdb soc_clients_test
   ```

2. Install dependencies:
   ```bash
   npm install dotenv-cli --save-dev
   ```

3. Run tests:
   ```bash
   npm run test:e2e
   ```

## Test Structure

- `setup.ts` - Test setup utilities and database management
- `clients.e2e-spec.ts` - Client management endpoint tests
- `test.env` - Test environment configuration

## Test Coverage

The E2E tests cover:
- Client CRUD operations
- Compliance status management
- Client onboarding flows
- Archive/restore functionality
- Dashboard statistics
- Upcoming audits tracking
- Search and filtering
- Pagination and sorting
- Authorization (RBAC)
- Error handling

## Running Tests

```bash
# Run all E2E tests
npm run test:e2e

# Watch mode
npm run test:e2e:watch

# Run specific test
npm run test:e2e -- --testNamePattern="should create a new client"
```

## Database Management

The tests automatically:
- Clean the database before each test
- Seed test data as needed
- Handle foreign key constraints properly
- Close connections after tests complete

## Authentication

Tests use JWT tokens generated by the test setup. The setup provides:
- `generateAuthToken()` - Creates valid JWT tokens
- Role-based tokens for authorization testing
- Organization-scoped tokens

## Troubleshooting

If tests fail:
1. Ensure PostgreSQL is running
2. Verify test database exists
3. Check Redis is running with correct password
4. Verify test.env configuration matches your setup
5. Ensure Kafka is available (or mock it)